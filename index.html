<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>TACå‹‰å¼·ç®¡ç†ï¼ˆç¸¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç‰ˆï¼‰</title>
<meta name="theme-color" content="#FF8A5B">
<style>
:root{--bg:#fff7f3;--card:#ffffff;--text:#2a2a2a;--muted:#777;--primary:#FF8A5B;--accent:#2EC4B6;--radius:18px;--shadow:0 8px 24px rgba(0,0,0,.08)}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans JP",sans-serif;background:var(--bg);color:var(--text);overflow-x:hidden}
.appbar{position:sticky;top:0;z-index:5;background:#fff;padding:14px 16px;border-bottom:1px solid rgba(0,0,0,.06);font-weight:900;display:flex;justify-content:space-between;align-items:center}
.pill{background:#2EC4B6;color:#fff;border-radius:999px;padding:6px 10px;font-size:12px}
.container{max-width:900px;margin:0 auto;padding:12px 16px}
.card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px;margin:10px 0}
.row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.btn{background:var(--primary);color:#fff;border:none;border-radius:14px;padding:10px 14px;font-weight:700;cursor:pointer}
.btn.ghost{background:#fff;color:var(--primary);border:1px solid var(--primary)}
.sub{font-size:12px;color:var(--muted)}
.badge{background:#eee;border-radius:12px;padding:4px 8px;font-size:12px}
.bar{height:10px;background:#f0f0f0;border-radius:999px;overflow:hidden}
.bar>i{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--primary));width:0%}
.subject-dot{display:inline-block;width:10px;height:10px;border-radius:999px;margin-right:6px}
.watch{position:relative}
.watch.active{background:linear-gradient(90deg,#FF8A5B,#FFB88A);box-shadow:0 0 12px rgba(255,138,91,.6)}
@keyframes pop{0%{transform:scale(.96)}60%{transform:scale(1.04)}100%{transform:scale(1)}}
.watch.flash{animation:pop .25s ease}
.tabbar{position:sticky;bottom:0;background:#fff;border-top:1px solid rgba(0,0,0,.06);display:flex;gap:6px;justify-content:space-around;padding:10px}
.tabbar button{flex:1;border:none;background:transparent;padding:10px 6px;border-radius:12px;font-weight:800}
.tabbar button.active{background:#FFE9DF;color:#c24b19}
section{display:none}
section.active{display:block}
.input{border:1px solid #ddd;border-radius:12px;padding:8px 10px;font-size:14px;background:#fff;outline:none}
.divider{height:1px;background:rgba(0,0,0,.06);margin:8px 0}
.right{margin-left:auto}
</style>
</head>
<body>
<div class="appbar">
  <div>TACå‹‰å¼·ç®¡ç†</div>
  <div id="countdownHeader" class="pill" style="display:none"></div>
</div>
<div class="container">
  <section id="home" class="active">
    <!-- âœ… Homeã«ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ -->
    <div class="card" id="countdownCard" style="display:none">
      <div class="row" style="justify-content:space-between">
        <div style="font-weight:800">è©¦é¨“ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³</div>
        <div class="pill" id="countdownHome">è©¦é¨“ï¼šæœªè¨­å®š</div>
      </div>
    </div>

    <div class="card">
      <div class="row" style="justify-content:space-between">
        <div>
          <div class="sub">ä»Šé€±ã®åˆè¨ˆ</div>
          <div style="font-size:28px;font-weight:900"><span id="weekTotal">0.0</span> h <span class="badge">ç›®æ¨™ 25h</span></div>
        </div>
        <div style="min-width:180px">
          <div class="bar"><i id="weekBar" style="width:0%"></i></div>
          <div class="sub" id="weekPct">0%</div>
        </div>
      </div>
    </div>
    <div class="card">
      <div class="row" style="justify-content:space-between">
        <div>
          <div class="sub">ç·è¬›ç¾©é€²æ—</div>
          <div style="font-size:22px;font-weight:800"><span id="doneLectures">0</span>/<span id="totalLectures">216</span>ï¼ˆ<span id="progressPct">0%</span>ï¼‰</div>
        </div>
        <div style="min-width:200px">
          <div class="bar"><i id="progressBar"></i></div>
        </div>
      </div>
      <div class="sub">è¬›ç¾©ï¼‹å¾©ç¿’ã®åˆè¨ˆå­¦ç¿’æ™‚é–“ï¼š<b id="totalHours">0.0h</b></div>
    </div>
  </section>

  <section id="lectures">
    <div class="card">
      <div style="font-weight:800">è¬›ç¾©ãƒªã‚¹ãƒˆ</div>
      <div id="lectureList"></div>
    </div>
  </section>

  <section id="calendar">
    <div class="card">
      <div class="row" style="justify-content:space-between">
        <div style="font-weight:800">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</div>
        <div class="row">
          <button class="btn ghost" onclick="shiftMonth(-1)">â—€</button>
          <div class="badge" id="calHeader">yyyy/mm</div>
          <button class="btn ghost" onclick="shiftMonth(1)">â–¶</button>
        </div>
      </div>
      <div id="calGrid" style="display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin-top:8px"></div>
      <div class="sub">â€» è‰²ãŒæ¿ƒã„ã»ã©å­¦ç¿’æ™‚é–“ãŒå¤šã„ï¼ˆè¬›ç¾©ï¼‹å¾©ç¿’ï¼‰</div>
    </div>
  </section>

  <section id="settings">
    <div class="card">
      <div style="font-weight:800">è©¦é¨“ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³</div>
      <div class="row">
        <input type="date" id="examDate" class="input">
        <button class="btn" onclick="saveExamDate()">ä¿å­˜</button>
        <button class="btn ghost" onclick="clearExamDate()">æœªè¨­å®š</button>
      </div>
      <div class="sub">è¨­å®šã™ã‚‹ã¨ãƒ›ãƒ¼ãƒ ã¨ãƒ˜ãƒƒãƒ€ãƒ¼ã«ã€Œè©¦é¨“ã¾ã§â—¯æ—¥ã€ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</div>
    </div>
  </section>
</div>

<div class="tabbar">
  <button onclick="tab('home')" id="tab_home" class="active">ãƒ›ãƒ¼ãƒ </button>
  <button onclick="tab('lectures')" id="tab_lectures">è¬›ç¾©</button>
  <button onclick="tab('calendar')" id="tab_calendar">ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</button>
  <button onclick="tab('settings')" id="tab_settings">è¨­å®š</button>
</div>

<script>
/* ===== tabs (no horizontal scroll) ===== */
function tab(name){
  document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
  document.getElementById(name).classList.add('active');
  ['home','lectures','calendar','settings'].forEach(n=>document.getElementById('tab_'+n).classList.toggle('active', n===name));
}

/* ===== data ===== */
const SUBJECTS={"è²¡å‹™":"#FF8A5B","ç®¡ç†":"#FFD166","ç†è«–":"#8BC34A","ç›£æŸ»":"#5AA7FF","ä¼æ¥­":"#B07CFF"};
const INITIAL_LECTURES=[
  {subject:"è²¡å‹™", name:"è²¡å‹™å…¥é–€", total:5, done:5},
  {subject:"è²¡å‹™", name:"è²¡å‹™è¨ˆç®—åŸºç¤ãƒã‚¹ã‚¿ãƒ¼â‘ ", total:20, done:20},
  {subject:"è²¡å‹™", name:"è²¡å‹™è¨ˆç®—åŸºç¤ãƒã‚¹ã‚¿ãƒ¼â‘¡", total:16, done:2},
  {subject:"è²¡å‹™", name:"è²¡å‹™è¨ˆç®—åŸºç¤ãƒã‚¹ã‚¿ãƒ¼â‘¢", total:12, done:0},
  {subject:"è²¡å‹™", name:"è²¡å‹™è¨ˆç®—åŸºç¤ãƒã‚¹ã‚¿ãƒ¼â‘£", total:12, done:0},
  {subject:"è²¡å‹™", name:"è²¡å‹™ä¸Šç´šè¬›ç¾©", total:13, done:0},
  {subject:"ç®¡ç†", name:"ç®¡ç†å…¥é–€", total:9, done:9},
  {subject:"ç®¡ç†", name:"ç®¡ç†åŸºç¤ãƒã‚¹ã‚¿ãƒ¼", total:22, done:3},
  {subject:"ç®¡ç†", name:"ç®¡ç†ä¸Šç´š", total:14, done:0},
  {subject:"ç†è«–", name:"è²¡å‹™ç†è«–å…¥é–€", total:14, done:0},
  {subject:"ç†è«–", name:"è²¡å‹™ç†è«–ä¸Šç´š", total:22, done:0},
  {subject:"ç›£æŸ»", name:"ç›£æŸ»å…¥é–€", total:5, done:0},
  {subject:"ç›£æŸ»", name:"ç›£æŸ»ä¸Šç´š", total:20, done:0},
  {subject:"ä¼æ¥­", name:"ä¼æ¥­å…¥é–€", total:20, done:0},
  {subject:"ä¼æ¥­", name:"ä¼æ¥­ä¸Šç´š", total:10, done:0},
  {subject:"ä¼æ¥­", name:"ä¼æ¥­é‡‘å•†æ³•", total:2, done:0}
];
const STATE={lectures:[], examDate:null, weekGoal:25};

/* ===== utils ===== */
function uid(){return Math.random().toString(36).slice(2,9);}
function fmt(n){return (Math.round(n*10)/10).toFixed(1);}
function ymd(d){const y=d.getFullYear(),m=d.getMonth()+1,day=d.getDate();return `${y}-${String(m).padStart(2,'0')}-${String(day).padStart(2,'0')}`;}
function fromYmd(s){const [y,m,dd]=s.split('-').map(Number);const d=new Date(y,m-1,dd);d.setHours(0,0,0,0);return d;}
function startOfWeek(d){const z=new Date(d);const day=(z.getDay()+6)%7;z.setDate(z.getDate()-day);z.setHours(0,0,0,0);return z;}

/* ===== render ===== */
function renderAll(){ renderHome(); renderLectures(); renderCalendar(); renderCountdown(); }
function totalLectures(){ return STATE.lectures.reduce((a,b)=>a+b.total,0); }
function doneLectures(){ return STATE.lectures.reduce((a,b)=>a+b.done,0); }
function totalHours(){ let s=0; for(const L of STATE.lectures){ for(const g of (L.logs||[])){ s+=g.hours||0; } } return s; }
function weekHours(){ const sDate=startOfWeek(new Date()); let s=0; for(const L of STATE.lectures){ for(const g of (L.logs||[])){ const d=fromYmd(g.date); if(d>=sDate) s+=g.hours||0; } } return s; }

function renderHome(){
  document.getElementById('totalLectures').textContent=totalLectures();
  document.getElementById('doneLectures').textContent=doneLectures();
  const pct = totalLectures()? Math.round(doneLectures()/totalLectures()*100) : 0;
  document.getElementById('progressPct').textContent = pct+'%';
  document.getElementById('progressBar').style.width = pct+'%';
  const w=weekHours();
  const pctW=Math.min(100, Math.round(w/STATE.weekGoal*100));
  document.getElementById('weekTotal').textContent=fmt(w);
  document.getElementById('weekBar').style.width=pctW+'%';
  document.getElementById('weekPct').textContent=pctW+'%';
  document.getElementById('totalHours').textContent=fmt(totalHours())+'h';
}

function renderLectures(){
  const box=document.getElementById('lectureList'); box.innerHTML='';
  for(const L of STATE.lectures){
    const pct=Math.round((L.done/L.total)*100);
    const totalH=(L.logs||[]).reduce((a,b)=>a+(b.hours||0),0);
    const card=document.createElement('div'); card.className='card';
    card.innerHTML=`
      <div class="row" style="justify-content:space-between">
        <div>
          <div style="font-weight:800">${L.name}</div>
          <div class="sub"><span class="subject-dot" style="background:${SUBJECTS[L.subject]}"></span>${L.subject} ï¼ <b>${L.done}/${L.total}</b>ï¼ˆ${pct}%ï¼‰</div>
        </div>
        <div style="min-width:180px"><div class="bar"><i style="width:${pct}%"></i></div></div>
      </div>
      <div class="row" style="margin-top:8px">
        <button class="btn ghost" onclick="adjustProgress('${L.id}')">é€²æ—æ›´æ–°</button>
        <button class="btn watch" ${L.done>=L.total?'disabled':''} onclick="markWatched('${L.id}',this)">è¦–è´æ¸ˆã¿</button>
        <div class="right sub">ç´¯è¨ˆè‡ªç¿’ <b>${fmt(totalH)}h</b></div>
      </div>
      <div class="divider"></div>
      <div class="row">
        <input type="date" class="input" id="date_${L.id}" value="${ymd(new Date())}">
        <input type="number" class="input" id="hours_${L.id}" placeholder="è‡ªç¿’æ™‚é–“(h) ä¾‹: 1.5" step="0.25" min="0">
        <button class="btn" onclick="addReview('${L.id}')">è‡ªç¿’ã‚’è¨˜éŒ²</button>
      </div>
    `;
    box.appendChild(card);
  }
}

/* ===== calendar (with month navigation) ===== */
let calMonth = new Date(); // ç¾åœ¨ã®è¡¨ç¤ºæœˆ
function renderCalendar(){
  const y=calMonth.getFullYear(), m=calMonth.getMonth();
  const calHeader=document.getElementById('calHeader');
  const grid=document.getElementById('calGrid'); grid.innerHTML='';
  calHeader.textContent = `${y}/${String(m+1).padStart(2,'0')}`;
  const first=new Date(y,m,1);
  const start=first.getDay(); // 0(æ—¥)ã€œ6(åœŸ)
  const days=new Date(y,m+1,0).getDate();
  for(let i=0;i<start;i++){ const empty=document.createElement('div'); grid.appendChild(empty); }
  for(let d=1; d<=days; d++){
    const dateStr=`${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
    const hrs=dayHours(dateStr);
    const depth=Math.min(1, hrs/4);
    const cell=document.createElement('div'); cell.className='card'; cell.style.padding='8px';
    cell.style.background=`linear-gradient(180deg, rgba(46,196,182,${0.12+0.55*depth}), #fff)`;
    cell.innerHTML=`<div style="font-weight:800">${d}</div><div class="sub">${fmt(hrs)}h</div>`;
    grid.appendChild(cell);
  }
}
function shiftMonth(delta){ calMonth.setMonth(calMonth.getMonth()+delta); renderCalendar(); }

function dayHours(dateStr){
  let s=0; for(const L of STATE.lectures){ for(const g of (L.logs||[])){ if(g.date===dateStr) s+=g.hours||0; } } return s;
}

/* ===== countdown (exam date) ===== */
function renderCountdown(){
  const pillHeader=document.getElementById('countdownHeader');
  const card=document.getElementById('countdownCard');
  const pillHome=document.getElementById('countdownHome');
  if(!STATE.examDate){
    pillHeader.style.display='none';
    card.style.display='none';
    return;
  }
  const today = new Date(); today.setHours(0,0,0,0);
  const target = fromYmd(STATE.examDate);
  const diff = Math.ceil((target - today)/(1000*60*60*24));
  const text = diff>=0 ? `è©¦é¨“ã¾ã§ ${diff}æ—¥` : `è©¦é¨“ï¼šçµ‚äº†`;
  pillHeader.textContent=text; pillHeader.style.display='inline-block';
  pillHome.textContent=text; card.style.display='block';
}
function saveExamDate(){
  const v=document.getElementById('examDate').value||null;
  STATE.examDate=v; renderCountdown();
}
function clearExamDate(){ STATE.examDate=null; document.getElementById('examDate').value=''; renderCountdown(); }

/* ===== actions ===== */
function adjustProgress(id){
  const L=STATE.lectures.find(x=>x.id===id);
  const v=prompt(`${L.name} ã®å®Œäº†è¬›ç¾©æ•°ï¼ˆ0ã€œ${L.total}ï¼‰ï¼š`, String(L.done));
  if(v===null) return;
  L.done=Math.max(0,Math.min(L.total,parseInt(v,10)||0));
  renderAll();
}
function markWatched(id,btn){
  const L=STATE.lectures.find(x=>x.id===id); if(!L) return;
  if(L.done>=L.total) return;
  L.done+=1; btn.classList.add('active','flash'); setTimeout(()=>btn.classList.remove('flash'),300);
  if(L.done>=L.total) btn.disabled=true;
  renderAll();
}
function addReview(id){
  const L=STATE.lectures.find(x=>x.id===id); if(!L) return;
  const date = document.getElementById('date_'+id).value || ymd(new Date());
  const hours = parseFloat(document.getElementById('hours_'+id).value||'0');
  if(!(hours>0)){ alert('è‡ªç¿’æ™‚é–“(h)ã‚’å…¥åŠ›ã—ã¦ã­'); return; }
  if(!L.logs) L.logs=[];
  L.logs.push({date, type:'review', hours});
  document.getElementById('hours_'+id).value='';
  renderAll();
}

/* ===== init ===== */
function boot(){
  STATE.lectures = INITIAL_LECTURES.map(l=>({...l, id:uid(), logs:[]}));
  renderAll();
}
window.addEventListener('load', boot);
</script>
  <script src="save.js"></script>
<script>
(() => {
  const KEY = "tac:save";

  function saveData() {
    const data = {};
    document.querySelectorAll("input, textarea, select").forEach(el => {
      const id = el.id || el.name;
      if (!id) return;
      if (el.type === "checkbox" || el.type === "radio") {
        data[id] = el.checked;
      } else {
        data[id] = el.value;
      }
    });
    localStorage.setItem(KEY, JSON.stringify(data));
    alert("ä¿å­˜ã—ã¾ã—ãŸï¼");
  }

  function loadData() {
    const raw = localStorage.getItem(KEY);
    if (!raw) return;
    const data = JSON.parse(raw);
    for (const [id, val] of Object.entries(data)) {
      const el = document.getElementById(id) || document.getElementsByName(id)[0];
      if (!el) continue;
      if (el.type === "checkbox" || el.type === "radio") {
        el.checked = val;
      } else {
        el.value = val;
      }
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    loadData();

    // å³ä¸‹ã«ã€Œä¿å­˜ã€ãƒœã‚¿ãƒ³ã‚’å‡ºã™
    const btn = document.createElement("button");
    btn.textContent = "ğŸ’¾ ä¿å­˜";
    Object.assign(btn.style, {
      position:"fixed", right:"20px", bottom:"20px",
      padding:"10px 16px", background:"#4CAF50", color:"#fff",
      border:"none", borderRadius:"8px", fontSize:"16px",
      cursor:"pointer", zIndex:"9999"
    });
    btn.onclick = saveData;
    document.body.appendChild(btn);
  });
})();
</script>
  <!-- ä¸€åº¦ã ã‘SWã‚’ç„¡åŠ¹åŒ–ã—ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å¤–ã™ -->
<script>navigator.serviceWorker&&navigator.serviceWorker.getRegistrations().then(rs=>rs.forEach(r=>r.unregister()));</script>
<!-- ä¿å­˜ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥å›é¿ã®ãŸã‚ ?v=3 ã‚’ä»˜ã‘ã‚‹ï¼‰ -->
<script src="save.js?v=3"></script>
</body>
</html>
